<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¦¬ë“¬ í›ˆë ¨ (Vivid Orange Ver)</title>
    <style>
        body {
            background-color: #fffbf0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            color: #4e342e;
        }

        /* --- ë ˆì´ì•„ì›ƒ --- */
        .container {
            display: flex;
            flex-direction: row;
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            gap: 40px;
        }

        .left-panel {
            flex: 1;
            background: #ffffff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(78, 52, 46, 0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: fit-content;
            position: sticky;
            top: 20px; 
            border: 1px solid #efebe9;
        }

        .right-panel {
            flex: 2;
            background: #ffffff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(78, 52, 46, 0.08);
            display: flex;
            flex-direction: column;
            border: 1px solid #efebe9;
        }

        @media (max-width: 900px) {
            .container { flex-direction: column; gap: 20px; }
            .left-panel { position: static; width: auto; }
        }

        h2 {
            color: #4e342e;
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0 0 30px 0;
            text-align: center;
            border-bottom: 4px solid #ff9800;
            padding-bottom: 10px;
            width: 100%;
        }

        /* --- ë©”íŠ¸ë¡œë†ˆ UI --- */
        .emoji-container {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            width: 100%;
            background-color: #fff3e0;
            border-radius: 15px;
        }

        .emoji-display {
            font-size: 6rem;
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .play-btn {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 15px 0;
            width: 100%;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(255, 152, 0, 0.3);
            transition: all 0.1s ease;
        }
        .play-btn:active { transform: scale(0.98); }
        .play-btn.playing {
            background-color: #f57c00;
            box-shadow: 0 6px 15px rgba(245, 124, 0, 0.3);
        }

        /* --- ìš°ì¸¡ íŒ¨ë„ UI --- */
        .section-header {
            font-size: 1.2rem;
            color: #8d6e63;
            margin-bottom: 15px;
            font-weight: 700;
            border-left: 5px solid #ff9800;
            padding-left: 10px;
        }

        .day-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }

        .day-btn {
            background-color: #fff;
            border: 1px solid #d7ccc8;
            border-radius: 8px;
            padding: 10px 5px;
            font-size: 0.9rem;
            color: #5d4037;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .day-btn:hover { background-color: #efebe9; }
        .day-btn.active {
            background-color: #ffe0b2;
            border-color: #ff9800;
            color: #e65100;
            font-weight: 800;
        }

        #selectedDayTitle {
            font-size: 1.5rem;
            font-weight: 800;
            color: #4e342e;
            margin-bottom: 25px;
            padding: 10px;
            background-color: #fff8e1;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        /* --- ì¹´ë“œ ë° ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ --- */
        .word-row {
            display: flex;
            flex-direction: column; 
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #efebe9;
        }

        /* ìƒë‹¨: ë‹¨ì–´ ì¹´ë“œì™€ ìŒì ˆ ì¹´ë“œê°€ ë¬´ì¡°ê±´ í•œ ì¤„ì— ë‚˜ì˜¤ë„ë¡ ì„¤ì • */
        .word-top-section {
            display: flex;
            flex-direction: row; 
            align-items: flex-start;
            gap: 15px; 
            flex-wrap: nowrap; 
            width: 100%;
            overflow-x: auto; 
            -ms-overflow-style: none; 
            scrollbar-width: none; 
        }
        .word-top-section::-webkit-scrollbar {
            display: none; 
        }

        /* 1. ë‹¨ì–´ ì¹´ë“œ & ì˜¤ë””ì˜¤ ë²„íŠ¼ ë˜í¼ */
        .word-col {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 140px; 
            flex-shrink: 0;
        }

        .word-card-main {
            background-color: #ff9800;
            color: #3e2723;
            border: none;
            box-shadow: none;
            padding: 0 10px;
            height: 60px; 
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 1.4rem; 
            font-weight: 400; 
            width: 100%;
            box-sizing: border-box;
        }
        .word-card-main b { font-weight: 900; }

        /* ì˜¤ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ */
        .audio-btn-group {
            display: flex;
            gap: 6px;
            width: 100%;
        }

        .audio-btn {
            flex: 1;
            background-color: #fff3e0;
            color: #e65100;
            border: 1px solid #ffb74d;
            border-radius: 6px;
            padding: 6px 0;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap; 
            letter-spacing: -0.5px; 
        }

        .audio-btn:hover { background-color: #ffe0b2; }
        .audio-btn:active { transform: scale(0.95); }

        /* 2. ë°œìŒê¸°í˜¸ ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
        .syllable-container {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: nowrap; 
            flex-shrink: 0; 
        }

        .syllable-card {
            min-width: 70px; 
            height: 60px;
            padding: 0 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.4rem;
            border-radius: 12px;
            background-color: white;
            box-sizing: border-box;
        }
        
        /* 1ê°•ì„¸ (ì£¼í™©ìƒ‰ ì‹¤ì„ ) */
        .syllable-strong {
            border: 3px solid #ff9800;
            color: #3e2723;
            font-weight: 900;
        }
        
        /* 2ê°•ì„¸ (ì£¼í™©ìƒ‰ ì ì„ , ê¸°ë³¸ í°íŠ¸ ìƒ‰ìƒ) */
        .syllable-secondary {
            border: 2px dashed #ff9800; 
            color: #3e2723; /* ì£¼í™©ìƒ‰ í°íŠ¸ ì œê±°, ê¸°ë³¸ ì§„í•œ ìƒ‰ìœ¼ë¡œ ìœ ì§€ */
            font-weight: 700;
        }
        
        /* ì•½ê°•ì„¸ (íšŒìƒ‰ ì ì„ ) */
        .syllable-weak {
            border: 2px dashed #bcaaa4;
            color: #8d6e63;
        }

        /* 3. ë°œìŒ ì—°ìŠµ ìˆœì„œ (Step by Step) ìŠ¤íƒ€ì¼ */
        .step-box {
            background-color: #fff3e0;
            border-left: 5px solid #ffcc80;
            padding: 15px 20px;
            border-radius: 8px; 
            font-size: 1.2rem; 
            color: #5d4037;
            line-height: 1.6;
            width: 100%; 
            box-sizing: border-box;
            word-break: break-word; 
        }
        .step-highlight {
            color: #e65100;
            font-weight: 700;
        }

        /* ëª¨ë°”ì¼ í™”ë©´ ì „ìš© ë””ìì¸ */
        @media (max-width: 600px) {
            .word-top-section { gap: 8px; }
            .word-col { width: 110px; }
            .word-card-main { height: 50px; font-size: 1.2rem; }
            .audio-btn { font-size: 0.75rem; padding: 5px 0; }
            .syllable-container { gap: 6px; }
            .syllable-card { min-width: 50px; height: 50px; font-size: 1.2rem; padding: 0 10px; }
            .step-box { font-size: 1rem; padding: 12px 15px; }
        }

    </style>
</head>
<body>

<div class="container" id="main-content">
    <div class="left-panel">
        <h2>ë‹¨ì–´ ë¦¬ë“¬ í›ˆë ¨</h2>
        <div class="emoji-container">
            <div id="visualDisplay" class="emoji-display">ğŸ«¸ğŸ» ğŸ«·ğŸ»</div>
        </div>
        <button id="playBtn" class="play-btn">START</button>
        <div style="margin-top: 20px; font-size: 0.9rem; color: #8d6e63; text-align: center;">
            ì†Œë¦¬ë¥¼ ì¼œê³ <br>ì£¼í™©ìƒ‰ í…Œë‘ë¦¬ì— ê°•ì„¸ë¥¼ ì£¼ì„¸ìš”!
        </div>
    </div>

    <div class="right-panel">
        <div class="section-header">í•™ìŠµí•  ìŒì†Œ ì„ íƒ</div>
        <div id="dayButtons" class="day-grid"></div>

        <div id="selectedDayTitle"></div>
        
        <div id="wordList">
            <div style="text-align: center; color: #bcaaa4; padding: 40px;">
                ìœ„ì—ì„œ í•™ìŠµí•  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
            </div>
        </div>
    </div>
</div>

<script>
    // 2ê°•ì„¸(secondary_stress)ê°€ í•„ìš”í•œ ë‹¨ì–´ë“¤ì— ì •ë³´ë¥¼ ì¶”ê°€í•˜ê³ , stepsì˜ [] ê´„í˜¸ë¥¼ ì‚­ì œí•œ ë°ì´í„°ì…ë‹ˆë‹¤.
    const wordData = [
        { day: 24, title: "Schwa (ìŠˆì™€)", words: [
            { w: "a<b>tten</b>tion", ipa_parts: ["É™", "ten", "ÊƒÉ™n"], stress: 1, steps: "t - t - te - te - ten - ten.ÊƒÉ™n - É™Ëˆten.ÊƒÉ™n" },
            { w: "a<b>vai</b>lable", ipa_parts: ["É™", "veÉª", "lÉ™", "bl"], stress: 1, steps: "v - v - veÉª - veÉª - veÉª.lÉ™ - veÉª.lÉ™.bl - É™ËˆveÉª.lÉ™.bl" },
            { w: "a<b>gain</b>", ipa_parts: ["É™", "É¡en"], stress: 1, steps: "É¡ - É¡ - É¡e - É¡e - É¡en - É™ËˆÉ¡en" },
            { w: "<b>diff</b>erent", ipa_parts: ["dÉªf", "É™r", "É™nt"], stress: 0, steps: "d - d - dÉª - dÉª - dÉªf - dÉªf.É™r - ËˆdÉªf.É™r.É™nt" },
            { w: "<b>his</b>tory", ipa_parts: ["hÉªs", "tÉ™r", "i"], stress: 0, steps: "h - h - hÉª - hÉª - hÉªs - hÉªs.tÉ™r - ËˆhÉªs.tÉ™r.i" },
            { w: "<b>pro</b>blem", ipa_parts: ["prÉ‘Ë", "blÉ™m"], stress: 0, steps: "p - p - prÉ‘Ë - prÉ‘Ë - ËˆprÉ‘Ë.blÉ™m" },
            { w: "so<b>ci</b>ety", ipa_parts: ["sÉ™", "saÉª", "É™", "ti"], stress: 1, steps: "s - s - saÉª - saÉª - saÉª.É™ - saÉª.É™.ti - sÉ™ËˆsaÉª.É™.ti" },
            { w: "po<b>sit</b>ion", ipa_parts: ["pÉ™", "zÉªÊƒ", "É™n"], stress: 1, steps: "z - z - zÉª - zÉª - zÉªÊƒ - zÉªÊƒ.É™n - pÉ™ËˆzÉªÊƒ.É™n" },
            { w: "<b>pa</b>sta", ipa_parts: ["pÉ‘Ë", "stÉ™"], stress: 0, steps: "p - p - pÉ‘Ë - pÉ‘Ë - ËˆpÉ‘Ë.stÉ™" },
            { w: "<b>piz</b>za", ipa_parts: ["piËt", "sÉ™"], stress: 0, steps: "p - p - piË - piË - piËt - ËˆpiËt.sÉ™" }
        ]},
        { day: 25, title: "H Sound", words: [
            { w: "<b>ham</b>ster", ipa_parts: ["hÃ¦m", "stÉ™r"], stress: 0, steps: "h - h - hÃ¦ - hÃ¦ - hÃ¦m - ËˆhÃ¦m.stÉ™r" },
            { w: "<b>ho</b>bby", ipa_parts: ["hÉ‘Ë", "bi"], stress: 0, steps: "h - h - hÉ‘Ë - hÉ‘Ë - ËˆhÉ‘Ë.bi" },
            { w: "be<b>hind</b>", ipa_parts: ["bÉª", "haÉªnd"], stress: 1, steps: "h - h - haÉª - haÉª - haÉªnd - bÉªËˆhaÉªnd" },
            { w: "re<b>heat</b>", ipa_parts: ["riË", "hiËt"], stress: 1, secondary_stress: 0, steps: "h - h - hiË - hiË - hiËt - ËŒriËËˆhiËt" },
            { w: "un<b>happ</b>y", ipa_parts: ["ÊŒn", "hÃ¦p", "i"], stress: 1, secondary_stress: 0, steps: "h - h - hÃ¦ - hÃ¦ - hÃ¦p - hÃ¦p.i - ËŒÊŒnËˆhÃ¦p.i" }
        ]},
        { day: 26, title: "P / B", words: [
            { w: "<b>peo</b>ple", ipa_parts: ["piË", "pÉ™l"], stress: 0, steps: "p - p - piË - piË - ËˆpiË.pÉ™l" },
            { w: "<b>pa</b>per", ipa_parts: ["peÉª", "pÉ™r"], stress: 0, steps: "p - p - peÉª - peÉª - ËˆpeÉª.pÉ™r" },
            { w: "<b>pu</b>ppy", ipa_parts: ["pÊŒ", "pi"], stress: 0, steps: "p - p - pÊŒ - pÊŒ - ËˆpÊŒ.pi" },
            { w: "Ja<b>pan</b>", ipa_parts: ["dÊ’É™", "pÃ¦n"], stress: 1, steps: "p - p - pÃ¦ - pÃ¦ - pÃ¦n - dÊ’É™ËˆpÃ¦n" },
            { w: "<b>happ</b>y", ipa_parts: ["hÃ¦p", "i"], stress: 0, steps: "h - h - hÃ¦ - hÃ¦ - hÃ¦p - ËˆhÃ¦p.i" },
            { w: "<b>ba</b>con", ipa_parts: ["beÉª", "kÉ™n"], stress: 0, steps: "b - b - beÉª - beÉª - ËˆbeÉª.kÉ™n" },
            { w: "<b>bus</b>y", ipa_parts: ["bÉªz", "i"], stress: 0, steps: "b - b - bÉª - bÉª - bÉªz - ËˆbÉªz.i" },
            { w: "<b>ba</b>by", ipa_parts: ["beÉª", "bi"], stress: 0, steps: "b - b - beÉª - beÉª - ËˆbeÉª.bi" },
            { w: "a<b>bout</b>", ipa_parts: ["É™", "baÊŠt"], stress: 1, steps: "b - b - baÊŠ - baÊŠ - baÊŠt - É™ËˆbaÊŠt" },
            { w: "o<b>bey</b>", ipa_parts: ["É™", "beÉª"], stress: 1, steps: "b - b - beÉª - beÉª - É™ËˆbeÉª" }
        ]},
        { day: 27, title: "K / G", words: [
            { w: "<b>ki</b>wi", ipa_parts: ["kiË", "wiË"], stress: 0, steps: "k - k - kiË - kiË - ËˆkiË.wiË" },
            { w: "be<b>cause</b>", ipa_parts: ["bÉª", "kÉ‘:z"], stress: 1, steps: "k - k - kÉ‘: - kÉ‘: - kÉ‘:z - bÉªËˆkÉ‘:z" },
            { w: "<b>kit</b>chen", ipa_parts: ["kÉªtÊƒ", "É™n"], stress: 0, steps: "k - k - kÉª - kÉª - kÉªtÊƒ - ËˆkÉªtÊƒ.É™n" },
            { w: "be<b>come</b>", ipa_parts: ["bÉª", "kÊŒm"], stress: 1, steps: "k - k - kÊŒ - kÊŒ - kÊŒm - bÉªËˆkÊŒm" },
            { w: "<b>book</b>ing", ipa_parts: ["bÊŠk", "ÉªÅ‹"], stress: 0, steps: "b - b - bÊŠ - bÊŠ - bÊŠk - ËˆbÊŠk.ÉªÅ‹" },
            { w: "<b>gum</b>my", ipa_parts: ["É¡ÊŒm", "i"], stress: 0, steps: "É¡ - É¡ - É¡ÊŒ - É¡ÊŒ - É¡ÊŒm - ËˆÉ¡ÊŒm.i" },
            { w: "good<b>bye</b>", ipa_parts: ["É¡ÊŠd", "baÉª"], stress: 1, secondary_stress: 0, steps: "b - b - baÉª - baÉª - ËŒÉ¡ÊŠdËˆbaÉª" },
            { w: "be<b>gin</b>", ipa_parts: ["bÉª", "É¡Éªn"], stress: 1, steps: "É¡ - É¡ - É¡Éª - É¡Éª - É¡Éªn - bÉªËˆÉ¡Éªn" },
            { w: "a<b>gain</b>", ipa_parts: ["É™", "É¡en"], stress: 1, steps: "É¡ - É¡ - É¡e - É¡e - É¡en - É™ËˆÉ¡en" },
            { w: "a<b>gainst</b>", ipa_parts: ["É™", "É¡enst"], stress: 1, steps: "É¡ - É¡ - É¡e - É¡e - É¡enst - É™ËˆÉ¡enst" }
        ]},
        { day: 28, title: "True T/D, Flap T/D", words: [
            { w: "<b>ta</b>ble", ipa_parts: ["teÉª", "bÉ™l"], stress: 0, steps: "t - t - teÉª - teÉª - ËˆteÉª.bÉ™l" },
            { w: "fif<b>teen</b>", ipa_parts: ["fÉªf", "tiËn"], stress: 1, secondary_stress: 0, steps: "t - t - tiË - tiË - tiËn - ËŒfÉªfËˆtiËn" },
            { w: "<b>ti</b>ny", ipa_parts: ["taÉª", "ni"], stress: 0, steps: "t - t - taÉª - taÉª - ËˆtaÉª.ni" },
            { w: "<b>doc</b>tor", ipa_parts: ["dÉ‘Ëk", "tÉ™r"], stress: 0, steps: "d - d - dÉ‘Ë - dÉ‘Ë - dÉ‘Ëk - ËˆdÉ‘Ëk.tÉ™r" },
            { w: "to<b>day</b>", ipa_parts: ["tÉ™", "deÉª"], stress: 1, steps: "d - d - deÉª - deÉª - tÉ™ËˆdeÉª" },
            { w: "<b>bet</b>ter", ipa_parts: ["bet", "É™r"], stress: 0, steps: "b - b - be - be - bet - Ëˆbet.É™r" },
            { w: "<b>ti</b>tle", ipa_parts: ["taÉª", "tÉ™l"], stress: 0, steps: "t - t - taÉª - taÉª - ËˆtaÉª.tÉ™l" },
            { w: "<b>la</b>dy", ipa_parts: ["leÉª", "di"], stress: 0, steps: "l - l - leÉª - leÉª - ËˆleÉª.di" },
            { w: "<b>stud</b>y", ipa_parts: ["stÊŒd", "i"], stress: 0, steps: "s - s - stÊŒ - stÊŒ - stÊŒd - ËˆstÊŒd.i" },
            { w: "<b>ladd</b>er", ipa_parts: ["lÃ¦d", "É™r"], stress: 0, steps: "l - l - lÃ¦ - lÃ¦ - lÃ¦d - ËˆlÃ¦d.É™r" }
        ]},
        { day: 29, title: "Stop T/D, No T", words: [
            { w: "<b>cur</b>tain", ipa_parts: ["kÉœ:r", "tÉ™n"], stress: 0, steps: "k - k - kÉœ:r - kÉœ:r - ËˆkÉœ:r.tÉ™n" },
            { w: "<b>fit</b>ness", ipa_parts: ["fÉªt", "nÉ™s"], stress: 0, steps: "f - f - fÉª - fÉª - fÉªt - ËˆfÉªt.nÉ™s" },
            { w: "<b>butt</b>on", ipa_parts: ["bÊŒt", "É™n"], stress: 0, steps: "b - b - bÊŒ - bÊŒ - bÊŒt - ËˆbÊŒt.É™n" },
            { w: "good<b>will</b>", ipa_parts: ["É¡ÊŠd", "wÉªl"], stress: 1, secondary_stress: 0, steps: "w - w - wÉª - wÉª - wÉªl - ËŒÉ¡ÊŠdËˆwÉªl" },
            { w: "<b>feed</b>back", ipa_parts: ["fiËd", "bÃ¦k"], stress: 0, secondary_stress: 1, steps: "f - f - fiË - fiË - fiËd - ËˆfiËd.ËŒbÃ¦k" },
            { w: "<b>in</b>ternet", ipa_parts: ["Éªn", "tÉ™r", "net"], stress: 0, secondary_stress: 2, steps: "Éª - Éª - Éªn - Éªn - Éªn.tÉ™r - ËˆÉªn.tÉ™r.ËŒnet" },
            { w: "<b>cen</b>ter", ipa_parts: ["sen", "tÉ™r"], stress: 0, steps: "s - s - se - se - sen - Ëˆsen.tÉ™r" },
            { w: "<b>per</b>fectly", ipa_parts: ["pÉœ:r", "fÉªk", "li"], stress: 0, steps: "p - p - pÉœ:r - pÉœ:r - pÉœ:r.fÉªk - ËˆpÉœ:r.fÉªk.li" },
            { w: "co<b>rrect</b>ly", ipa_parts: ["kÉ™", "rek", "li"], stress: 1, steps: "r - r - re - re - rek - rek.li - kÉ™Ëˆrek.li" },
            { w: "<b>in</b>terview", ipa_parts: ["Éªn", "tÉ™r", "vjuË"], stress: 0, secondary_stress: 2, steps: "Éª - Éª - Éªn - Éªn - Éªn.tÉ™r - ËˆÉªn.tÉ™r.ËŒvjuË" }
        ]},
        { day: 30, title: "S / Z", words: [
            { w: "<b>steak</b>", ipa_parts: ["steÉªk"], stress: 0, steps: "s - s - steÉª - steÉª - steÉªk" },
            { w: "<b>sis</b>ter", ipa_parts: ["sÉªs", "tÉ™r"], stress: 0, steps: "s - s - sÉª - sÉª - sÉªs - ËˆsÉªs.tÉ™r" },
            { w: "<b>sum</b>mer", ipa_parts: ["sÊŒm", "É™r"], stress: 0, steps: "s - s - sÊŒ - sÊŒ - sÊŒm - ËˆsÊŒm.É™r" },
            { w: "suc<b>cess</b>", ipa_parts: ["sÉ™k", "ses"], stress: 1, steps: "s - s - se - se - ses - sÉ™kËˆses" },
            { w: "re<b>spond</b>", ipa_parts: ["rÉª", "spÉ‘Ënd"], stress: 1, steps: "s - s - spÉ‘Ë - spÉ‘Ë - spÉ‘Ënd - rÉªËˆspÉ‘Ënd" },
            { w: "<b>zip</b>per", ipa_parts: ["zÉªp", "É™r"], stress: 0, steps: "z - z - zÉª - zÉª - zÉªp - ËˆzÉªp.É™r" },
            { w: "<b>ze</b>bra", ipa_parts: ["ziË", "brÉ™"], stress: 0, steps: "z - z - ziË - ziË - ËˆziË.brÉ™" },
            { w: "un<b>zip</b>", ipa_parts: ["ÊŒn", "zÉªp"], stress: 1, secondary_stress: 0, steps: "z - z - zÉª - zÉª - zÉªp - ËŒÊŒnËˆzÉªp" },
            { w: "<b>cou</b>sin", ipa_parts: ["kÊŒz", "É™n"], stress: 0, steps: "k - k - kÊŒ - kÊŒ - kÊŒz - ËˆkÊŒz.É™n" },
            { w: "<b>cheese</b>", ipa_parts: ["tÊƒiËz"], stress: 0, steps: "tÊƒ - tÊƒ - tÊƒiË - tÊƒiË - tÊƒiËz" }
        ]},
        { day: 31, title: "SH / ZH", words: [
            { w: "sham<b>poo</b>", ipa_parts: ["ÊƒÃ¦m", "puË"], stress: 1, secondary_stress: 0, steps: "p - p - puË - puË - ËŒÊƒÃ¦mËˆpuË" },
            { w: "<b>shad</b>ow", ipa_parts: ["ÊƒÃ¦d", "oÊŠ"], stress: 0, steps: "Êƒ - Êƒ - ÊƒÃ¦ - ÊƒÃ¦ - ÊƒÃ¦d - ËˆÊƒÃ¦d.oÊŠ" },
            { w: "<b>show</b>er", ipa_parts: ["ÊƒaÊŠ", "É™r"], stress: 0, steps: "Êƒ - Êƒ - ÊƒaÊŠ - ÊƒaÊŠ - ËˆÊƒaÊŠ.É™r" },
            { w: "<b>tiss</b>ue", ipa_parts: ["tÉªÊƒ", "uË"], stress: 0, steps: "t - t - tÉª - tÉª - tÉªÊƒ - ËˆtÉªÊƒ.uË" },
            { w: "<b>fin</b>ish", ipa_parts: ["fÉªn", "ÉªÊƒ"], stress: 0, steps: "f - f - fÉª - fÉª - fÉªn - ËˆfÉªn.ÉªÊƒ" },
            { w: "<b>vis</b>ion", ipa_parts: ["vÉªÊ’", "É™n"], stress: 0, steps: "v - v - vÉª - vÉª - vÉªÊ’ - ËˆvÉªÊ’.É™n" },
            { w: "<b>a</b>sia", ipa_parts: ["eÉª", "Ê’É™"], stress: 0, steps: "eÉª - eÉª - ËˆeÉª.Ê’É™" },
            { w: "<b>lei</b>sure", ipa_parts: ["li:Ê’", "É™r"], stress: 0, steps: "l - l - li: - li: - li:Ê’ - Ëˆli:Ê’.É™r" },
            { w: "ma<b>ssage</b>", ipa_parts: ["mÉ™", "sÉ‘:Ê’"], stress: 1, steps: "s - s - sÉ‘: - sÉ‘: - sÉ‘:Ê’ - mÉ™ËˆsÉ‘:Ê’" },
            { w: "ga<b>rage</b>", ipa_parts: ["É¡É™", "rÉ‘:Ê’"], stress: 1, steps: "r - r - rÉ‘: - rÉ‘: - rÉ‘:Ê’ - É¡É™ËˆrÉ‘:Ê’" }
        ]},
        { day: 32, title: "F / V", words: [
            { w: "<b>fin</b>ger", ipa_parts: ["fÉªÅ‹", "É¡É™r"], stress: 0, steps: "f - f - fÉª - fÉª - fÉªÅ‹ - ËˆfÉªÅ‹.É¡É™r" },
            { w: "<b>fa</b>mous", ipa_parts: ["feÉª", "mÉ™s"], stress: 0, steps: "f - f - feÉª - feÉª - ËˆfeÉª.mÉ™s" },
            { w: "be<b>fore</b>", ipa_parts: ["bÉª", "fÉ”Ër"], stress: 1, steps: "f - f - fÉ”Ë - fÉ”Ë - fÉ”Ër - bÉªËˆfÉ”Ër" },
            { w: "<b>co</b>ffee", ipa_parts: ["kÉ‘:", "fi"], stress: 0, steps: "k - k - kÉ‘: - kÉ‘: - ËˆkÉ‘:.fi" },
            { w: "<b>leaf</b>", ipa_parts: ["liËf"], stress: 0, steps: "l - l - liË - liË - liËf" },
            { w: "vac<b>cine</b>", ipa_parts: ["vÃ¦k", "siËn"], stress: 1, secondary_stress: 0, steps: "s - s - siË - siË - siËn - ËŒvÃ¦kËˆsiËn" },
            { w: "<b>vill</b>age", ipa_parts: ["vÉªl", "ÉªdÊ’"], stress: 0, steps: "v - v - vÉª - vÉª - vÉªl - ËˆvÉªl.ÉªdÊ’" },
            { w: "pro<b>vide</b>", ipa_parts: ["prÉ™", "vaÉªd"], stress: 1, steps: "v - v - vaÉª - vaÉª - vaÉªd - prÉ™ËˆvaÉªd" },
            { w: "<b>dev</b>il", ipa_parts: ["dev", "É™l"], stress: 0, steps: "d - d - de - de - dev - Ëˆdev.É™l" },
            { w: "<b>leave</b>", ipa_parts: ["liËv"], stress: 0, steps: "l - l - liË - liË - liËv" }
        ]},
        { day: 33, title: "TH(Î¸) / TH(Ã°)", words: [
            { w: "<b>thir</b>ty", ipa_parts: ["Î¸Éœ:r", "ti"], stress: 0, steps: "Î¸ - Î¸ - Î¸Éœ:r - Î¸Éœ:r - ËˆÎ¸Éœ:r.ti" },
            { w: "<b>thank</b>ful", ipa_parts: ["Î¸Ã¦Å‹k", "fÉ™l"], stress: 0, steps: "Î¸ - Î¸ - Î¸Ã¦ - Î¸Ã¦ - Î¸Ã¦Å‹k - ËˆÎ¸Ã¦Å‹k.fÉ™l" },
            { w: "<b>birth</b>day", ipa_parts: ["bÉœ:rÎ¸", "deÉª"], stress: 0, secondary_stress: 1, steps: "b - b - bÉœ:r - bÉœ:r - bÉœ:rÎ¸ - ËˆbÉœ:rÎ¸.ËŒdeÉª" },
            { w: "re<b>think</b>", ipa_parts: ["riË", "Î¸ÉªÅ‹k"], stress: 1, secondary_stress: 0, steps: "Î¸ - Î¸ - Î¸Éª - Î¸Éª - Î¸ÉªÅ‹k - ËŒriËËˆÎ¸ÉªÅ‹k" },
            { w: "<b>mouth</b>", ipa_parts: ["maÊŠÎ¸"], stress: 0, steps: "m - m - maÊŠ - maÊŠ - maÊŠÎ¸" },
            { w: "<b>there</b>fore", ipa_parts: ["Ã°er", "fÉ”Ër"], stress: 0, secondary_stress: 1, steps: "Ã° - Ã° - Ã°er - Ã°er - ËˆÃ°er.ËŒfÉ”Ër" },
            { w: "them<b>selves</b>", ipa_parts: ["Ã°É™m", "selvz"], stress: 1, steps: "s - s - se - se - selvz - Ã°É™mËˆselvz" },
            { w: "<b>weath</b>er", ipa_parts: ["weÃ°", "É™r"], stress: 0, steps: "w - w - we - we - weÃ° - ËˆweÃ°.É™r" },
            { w: "a<b>noth</b>er", ipa_parts: ["É™", "nÊŒÃ°", "É™r"], stress: 1, steps: "n - n - nÊŒ - nÊŒ - nÊŒÃ° - nÊŒÃ°.É™r - É™ËˆnÊŒÃ°.É™r" },
            { w: "<b>bathe</b>", ipa_parts: ["beÉªÃ°"], stress: 0, steps: "b - b - beÉª - beÉª - beÉªÃ°" }
        ]},
        { day: 34, title: "Light L / Dark L", words: [
            { w: "<b>lem</b>on", ipa_parts: ["lem", "É™n"], stress: 0, steps: "l - l - le - le - lem - Ëˆlem.É™n" },
            { w: "<b>lis</b>ten", ipa_parts: ["lÉªs", "É™n"], stress: 0, steps: "l - l - lÉª - lÉª - lÉªs - ËˆlÉªs.É™n" },
            { w: "lo<b>ca</b>tion", ipa_parts: ["loÊŠ", "keÉª", "ÊƒÉ™n"], stress: 1, secondary_stress: 0, steps: "k - k - keÉª - keÉª - keÉª.ÊƒÉ™n - ËŒloÊŠËˆkeÉª.ÊƒÉ™n" },
            { w: "po<b>lice</b>", ipa_parts: ["pÉ™", "liËs"], stress: 1, steps: "l - l - liË - liË - liËs - pÉ™ËˆliËs" },
            { w: "e<b>lev</b>en", ipa_parts: ["É™", "lev", "É™n"], stress: 1, steps: "l - l - le - le - lev - lev.É™n - É™Ëˆlev.É™n" },
            { w: "<b>spoil</b>", ipa_parts: ["spÉ”Éªl"], stress: 0, steps: "s - s - spÉ”Éª - spÉ”Éª - spÉ”Éªl" },
            { w: "<b>lev</b>el", ipa_parts: ["lev", "É™l"], stress: 0, steps: "l - l - le - le - lev - Ëˆlev.É™l" },
            { w: "<b>tell</b>", ipa_parts: ["tel"], stress: 0, steps: "t - t - te - te - tel" },
            { w: "<b>vil</b>lage", ipa_parts: ["vÉªl", "ÉªdÊ’"], stress: 0, steps: "v - v - vÉª - vÉª - vÉªl - ËˆvÉªl.ÉªdÊ’" },
            { w: "<b>ball</b>", ipa_parts: ["bÉ‘Ël"], stress: 0, steps: "b - b - bÉ‘Ë - bÉ‘Ë - bÉ‘Ël" }
        ]},
        { day: 35, title: "R / W", words: [
            { w: "<b>re</b>ally", ipa_parts: ["riË", "É™l", "i"], stress: 0, steps: "r - r - riË - riË - riË.É™l - ËˆriË.É™l.i" },
            { w: "<b>read</b>y", ipa_parts: ["red", "i"], stress: 0, steps: "r - r - re - re - red - Ëˆred.i" },
            { w: "<b>rea</b>son", ipa_parts: ["riË", "zÉ™n"], stress: 0, steps: "r - r - riË - riË - ËˆriË.zÉ™n" },
            { w: "gi<b>raffe</b>", ipa_parts: ["dÊ’É™", "rÃ¦f"], stress: 1, steps: "r - r - rÃ¦ - rÃ¦ - rÃ¦f - dÊ’É™ËˆrÃ¦f" },
            { w: "a<b>rrive</b>", ipa_parts: ["É™", "raÉªv"], stress: 1, steps: "r - r - raÉª - raÉª - raÉªv - É™ËˆraÉªv" },
            { w: "<b>wa</b>ter", ipa_parts: ["wÉ‘:", "tÉ™r"], stress: 0, steps: "w - w - wÉ‘: - wÉ‘: - ËˆwÉ‘:.tÉ™r" },
            { w: "<b>weath</b>er", ipa_parts: ["weÃ°", "É™r"], stress: 0, steps: "w - w - we - we - weÃ° - ËˆweÃ°.É™r" },
            { w: "<b>week</b>end", ipa_parts: ["wiËk", "end"], stress: 0, secondary_stress: 1, steps: "w - w - wiË - wiË - wiËk - ËˆwiËk.ËŒend" },
            { w: "a<b>ware</b>", ipa_parts: ["É™", "wer"], stress: 1, steps: "w - w - wer - wer - É™Ëˆwer" },
            { w: "<b>home</b>work", ipa_parts: ["hoÊŠm", "wÉœ:rk"], stress: 0, secondary_stress: 1, steps: "h - h - hoÊŠ - hoÊŠ - hoÊŠm - ËˆhoÊŠm.ËŒwÉœ:rk" }
        ]},
        { day: 36, title: "rl / Y", words: [
            { w: "<b>re</b>al", ipa_parts: ["riË", "É™l"], stress: 0, steps: "r - r - riË - riË - ËˆriË.É™l" },
            { w: "<b>reg</b>ular", ipa_parts: ["reg", "jÉ™", "lÉ™r"], stress: 0, steps: "r - r - re - re - reg - reg.jÉ™ - Ëˆreg.jÉ™.lÉ™r" },
            { w: "<b>girl</b>", ipa_parts: ["gÉœ:rl"], stress: 0, steps: "g - g - gÉœ:r - gÉœ:r - gÉœ:rl" },
            { w: "<b>ear</b>ly", ipa_parts: ["Éœ:r", "li"], stress: 0, steps: "Éœ:r - Éœ:r - ËˆÉœ:r.li" },
            { w: "<b>world</b>", ipa_parts: ["wÉœ:rld"], stress: 0, steps: "w - w - wÉœ:r - wÉœ:r - wÉœ:rld" },
            { w: "<b>yell</b>ow", ipa_parts: ["yel", "oÊŠ"], stress: 0, steps: "y - y - yel - yel - Ëˆyel.oÊŠ" },
            { w: "your<b>self</b>", ipa_parts: ["jÉ™r", "self"], stress: 1, steps: "s - s - se - se - self - jÉ™rËˆself" },
            { w: "u<b>nique</b>", ipa_parts: ["ju", "niËk"], stress: 1, secondary_stress: 0, steps: "n - n - niË - niË - niËk - ËŒjuËˆniËk" },
            { w: "<b>val</b>ue", ipa_parts: ["vÃ¦l", "juË"], stress: 0, steps: "v - v - vÃ¦ - vÃ¦ - vÃ¦l - ËˆvÃ¦l.juË" },
            { w: "<b>vol</b>ume", ipa_parts: ["vÉ‘Ël", "juËm"], stress: 0, steps: "v - v - vÉ‘Ë - vÉ‘Ë - vÉ‘Ël - ËˆvÉ‘Ël.juËm" }
        ]},
        { day: 37, title: "CH / J", words: [
            { w: "<b>chil</b>dren", ipa_parts: ["tÊƒÉªl", "drÉ™n"], stress: 0, steps: "tÊƒ - tÊƒ - tÊƒÉª - tÊƒÉª - tÊƒÉªl - ËˆtÊƒÉªl.drÉ™n" },
            { w: "<b>chick</b>en", ipa_parts: ["tÊƒÉªk", "Éªn"], stress: 0, steps: "tÊƒ - tÊƒ - tÊƒÉª - tÊƒÉª - tÊƒÉªk - ËˆtÊƒÉªk.Éªn" },
            { w: "<b>chal</b>lenge", ipa_parts: ["tÊƒÃ¦l", "ÉªndÊ’"], stress: 0, steps: "tÊƒ - tÊƒ - tÊƒÃ¦ - tÊƒÃ¦ - tÊƒÃ¦l - ËˆtÊƒÃ¦l.ÉªndÊ’" },
            { w: "a<b>chieve</b>", ipa_parts: ["É™", "tÊƒiËv"], stress: 1, steps: "tÊƒ - tÊƒ - tÊƒiË - tÊƒiË - tÊƒiËv - É™ËˆtÊƒiËv" },
            { w: "<b>stretch</b>", ipa_parts: ["stretÊƒ"], stress: 0, steps: "s - s - str - str - stretÊƒ" },
            { w: "<b>jeal</b>ous", ipa_parts: ["dÊ’el", "É™s"], stress: 0, steps: "dÊ’ - dÊ’ - dÊ’e - dÊ’e - dÊ’el - ËˆdÊ’el.É™s" },
            { w: "<b>ju</b>nior", ipa_parts: ["dÊ’uË", "njÉ™r"], stress: 0, steps: "dÊ’ - dÊ’ - dÊ’uË - dÊ’uË - ËˆdÊ’uË.njÉ™r" },
            { w: "in<b>ject</b>", ipa_parts: ["Éªn", "dÊ’ekt"], stress: 1, steps: "dÊ’ - dÊ’ - dÊ’e - dÊ’e - dÊ’ekt - ÉªnËˆdÊ’ekt" },
            { w: "<b>know</b>ledge", ipa_parts: ["nÉ‘Ë", "lÉªdÊ’"], stress: 0, steps: "n - n - nÉ‘Ë - nÉ‘Ë - ËˆnÉ‘Ë.lÉªdÊ’" },
            { w: "<b>judge</b>", ipa_parts: ["dÊ’ÊŒdÊ’"], stress: 0, steps: "dÊ’ - dÊ’ - dÊ’ÊŒ - dÊ’ÊŒ - dÊ’ÊŒdÊ’" }
        ]},
        { day: 38, title: "M / N / NG", words: [
            { w: "<b>mon</b>ey", ipa_parts: ["mÊŒn", "i"], stress: 0, steps: "m - m - mÊŒ - mÊŒ - mÊŒn - ËˆmÊŒn.i" },
            { w: "<b>mag</b>net", ipa_parts: ["mÃ¦g", "nÉ™t"], stress: 0, steps: "m - m - mÃ¦ - mÃ¦ - mÃ¦g - ËˆmÃ¦g.nÉ™t" },
            { w: "ma<b>chine</b>", ipa_parts: ["mÉ™", "ÊƒiËn"], stress: 1, steps: "Êƒ - Êƒ - ÊƒiË - ÊƒiË - ÊƒiËn - mÉ™ËˆÊƒiËn" },
            { w: "<b>noth</b>ing", ipa_parts: ["nÊŒÎ¸", "ÉªÅ‹"], stress: 0, steps: "n - n - nÊŒ - nÊŒ - nÊŒÎ¸ - ËˆnÊŒÎ¸.ÉªÅ‹" },
            { w: "<b>neigh</b>bor", ipa_parts: ["neÉª", "bÉ™r"], stress: 0, steps: "n - n - neÉª - neÉª - ËˆneÉª.bÉ™r" },
            { w: "e<b>nough</b>", ipa_parts: ["É™", "nÊŒf"], stress: 1, steps: "n - n - nÊŒ - nÊŒ - nÊŒf - É™ËˆnÊŒf" },
            { w: "<b>funn</b>y", ipa_parts: ["fÊŒn", "i"], stress: 0, steps: "f - f - fÊŒ - fÊŒ - fÊŒn - ËˆfÊŒn.i" },
            { w: "<b>sing</b>er", ipa_parts: ["sÉªÅ‹", "É™r"], stress: 0, steps: "s - s - sÉª - sÉª - sÉªÅ‹ - ËˆsÉªÅ‹.É™r" },
            { w: "<b>fing</b>er", ipa_parts: ["fÉªÅ‹", "É¡É™r"], stress: 0, steps: "f - f - fÉª - fÉª - fÉªÅ‹ - ËˆfÉªÅ‹.É¡É™r" },
            { w: "<b>lon</b>gest", ipa_parts: ["lÉ‘ËÅ‹", "É¡Éªst"], stress: 0, steps: "l - l - lÉ‘Ë - lÉ‘Ë - lÉ‘ËÅ‹ - ËˆlÉ‘ËÅ‹.É¡Éªst" }
        ]}
    ];

    let currentAudio = null;

    function playWordAudio(word, rate) {
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
        }

        const cleanWord = word.replace(/<[^>]+>/g, '').toLowerCase().trim();
        const audioPath = `audio/${cleanWord}.mp3`; 

        currentAudio = new Audio(audioPath);
        currentAudio.playbackRate = rate;
        currentAudio.preservesPitch = true; 

        currentAudio.play().catch(error => {
            console.error("ìŒì› ì¬ìƒ ì˜¤ë¥˜:", error);
            alert(`ìŒì› íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${audioPath}\nHTML íŒŒì¼ê³¼ ê°™ì€ í´ë”ì— 'audio' í´ë”ë¥¼ ë§Œë“¤ê³  '${cleanWord}.mp3' íŒŒì¼ì„ ë„£ì–´ì£¼ì„¸ìš”.`);
        });
    }

    const dayButtonsContainer = document.getElementById('dayButtons');
    const selectedDayTitle = document.getElementById('selectedDayTitle');
    const wordListContainer = document.getElementById('wordList');

    wordData.forEach((data, index) => {
        const btn = document.createElement('button');
        btn.classList.add('day-btn');
        btn.innerText = `Day ${data.day}`;
        btn.addEventListener('click', () => selectDay(index));
        dayButtonsContainer.appendChild(btn);
    });

    function selectDay(index) {
        const data = wordData[index];
        const buttons = document.querySelectorAll('.day-btn');
        buttons.forEach((b, i) => {
            if (i === index) b.classList.add('active');
            else b.classList.remove('active');
        });

        selectedDayTitle.style.display = 'block';
        selectedDayTitle.innerText = `Day ${data.day}: ${data.title}`;
        wordListContainer.innerHTML = '';

        data.words.forEach(wordObj => {
            const row = document.createElement('div');
            row.classList.add('word-row');

            // ìƒë‹¨ ì˜ì—­ (ë‹¨ì–´ ì¹´ë“œ + ìŒì ˆ ì¹´ë“œ)
            const topSection = document.createElement('div');
            topSection.classList.add('word-top-section');

            // 1. ë‹¨ì–´ ì¹´ë“œ ì˜ì—­
            const wordCol = document.createElement('div');
            wordCol.classList.add('word-col');

            const wordCard = document.createElement('div');
            wordCard.classList.add('word-card-main');
            wordCard.innerHTML = wordObj.w; 
            wordCol.appendChild(wordCard);

            // ì˜¤ë””ì˜¤ ë²„íŠ¼
            const audioGroup = document.createElement('div');
            audioGroup.classList.add('audio-btn-group');
            const plainWord = wordObj.w.replace(/<[^>]+>/g, '');

            const btnNormal = document.createElement('button');
            btnNormal.classList.add('audio-btn');
            btnNormal.innerText = '1ë°°ì†';
            btnNormal.onclick = () => playWordAudio(plainWord, 1.0);

            const btnSlow = document.createElement('button');
            btnSlow.classList.add('audio-btn');
            btnSlow.innerText = '0.25ë°°ì†';
            btnSlow.onclick = () => playWordAudio(plainWord, 0.25);

            audioGroup.appendChild(btnNormal);
            audioGroup.appendChild(btnSlow);
            wordCol.appendChild(audioGroup);

            topSection.appendChild(wordCol);

            // 2. ìŒì ˆ ì¹´ë“œ ì»¨í…Œì´ë„ˆ
            const syllableContainer = document.createElement('div');
            syllableContainer.classList.add('syllable-container');

            wordObj.ipa_parts.forEach((ipaText, idx) => {
                const card = document.createElement('div');
                card.classList.add('syllable-card');
                card.innerText = ipaText;
                
                // ê°•ì„¸ êµ¬ë¶„ì— ë”°ë¥¸ í´ë˜ìŠ¤ ë¶€ì—¬
                if (idx === wordObj.stress) {
                    card.classList.add('syllable-strong');
                } else if (wordObj.secondary_stress !== undefined && idx === wordObj.secondary_stress) {
                    card.classList.add('syllable-secondary');
                } else {
                    card.classList.add('syllable-weak');
                }
                syllableContainer.appendChild(card);
            });
            
            topSection.appendChild(syllableContainer);
            row.appendChild(topSection);

            // 3. ë°œìŒ ë¹Œë“œì—… í…ìŠ¤íŠ¸
            if (wordObj.steps) {
                const stepBox = document.createElement('div');
                stepBox.classList.add('step-box');
                stepBox.innerHTML = `<span class="step-highlight">${wordObj.steps}</span>`;
                row.appendChild(stepBox);
            }

            wordListContainer.appendChild(row);
        });
    }

    const bpm = 100;
    const beatsPerMeasure = 2; 
    let audioContext = null;
    let noiseBuffer = null;
    let isPlaying = false;
    let currentBeat = 0; 
    let nextNoteTime = 0.0;
    let timerID = null;
    const lookahead = 25.0; 
    const scheduleAheadTime = 0.1; 
    
    const playBtn = document.getElementById('playBtn');
    const visualDisplay = document.getElementById('visualDisplay');

    function initAudio() {
        if (!audioContext) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioContext = new AudioContext();
            
            const emptySource = audioContext.createBufferSource();
            if(audioContext.createBuffer) {
                const buffer = audioContext.createBuffer(1, 1, 22050);
                emptySource.buffer = buffer;
                emptySource.connect(audioContext.destination);
                emptySource.start(0);
            }
            createNoiseBuffer();
        }
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }
    }

    function createNoiseBuffer() {
        if (!audioContext) return;
        const bufferSize = audioContext.sampleRate * 1.0; 
        const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            data[i] = (Math.random() * 2 - 1);
        }
        noiseBuffer = buffer;
    }

    function playClapSound(time) {
        if (!audioContext || !noiseBuffer) return;
        const source = audioContext.createBufferSource();
        source.buffer = noiseBuffer;
        const filter = audioContext.createBiquadFilter();
        filter.type = "lowpass"; 
        filter.frequency.value = 2000; 
        const envelope = audioContext.createGain();
        envelope.gain.setValueAtTime(1.25, time); 
        envelope.gain.exponentialRampToValueAtTime(0.01, time + 0.15); 
        source.connect(filter);
        filter.connect(envelope);
        envelope.connect(audioContext.destination);
        source.start(time);
        source.stop(time + 0.2);
    }

    function nextNote() {
        const secondsPerBeat = 60.0 / bpm;
        nextNoteTime += secondsPerBeat;
        currentBeat++;
        if (currentBeat >= beatsPerMeasure) {
            currentBeat = 0;
        }
    }

    function scheduleNote(beatNumber, time) {
        if (beatNumber === 0) {
            playClapSound(time);
        }
        const drawTime = (time - audioContext.currentTime) * 1000;
        setTimeout(() => {
            updateVisual(beatNumber);
        }, Math.max(0, drawTime));
    }

    function scheduler() {
        while (nextNoteTime < audioContext.currentTime + scheduleAheadTime) {
            scheduleNote(currentBeat, nextNoteTime);
            nextNote();
        }
        timerID = window.setTimeout(scheduler, lookahead);
    }

    function updateVisual(beatNumber) {
        if (beatNumber === 0) {
            visualDisplay.innerText = "ğŸ‘ğŸ»";
            visualDisplay.style.transform = "scale(1.3)"; 
        } else {
            visualDisplay.innerText = "ğŸ«¸ğŸ» ğŸ«·ğŸ»";
            visualDisplay.style.transform = "scale(1.0)"; 
        }
    }

    playBtn.addEventListener('click', function() {
        initAudio();
        isPlaying = !isPlaying;
        if (isPlaying) {
            currentBeat = 0;
            nextNoteTime = audioContext.currentTime + 0.1;
            scheduler();
            this.innerText = "STOP";
            this.classList.add("playing");
        } else {
            window.clearTimeout(timerID);
            visualDisplay.innerText = "ğŸ«¸ğŸ» ğŸ«·ğŸ»";
            visualDisplay.style.transform = "scale(1.0)";
            this.innerText = "START";
            this.classList.remove("playing");
        }
    });
</script>
</body>
</html>
